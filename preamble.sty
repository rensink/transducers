\usepackage{xspace}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{mathtools}
%\usepackage{MnSymbol}
\usepackage{stmaryrd}
\usepackage[inline]{enumitem}
\setlist{itemsep=0pt}
\usepackage{graphicx}
\usepackage{subcaption}
\usepackage{cleveref}
\usepackage{ulem}
\renewcommand{\ULdepth}{.7pt}
\normalem
\usepackage{comment}
\usepackage{algorithm}
\usepackage{centernot}
\usepackage[noend]{algpseudocode}
\algrenewcommand{\algorithmicfor}{{\bfseries\sffamily for}}
\algrenewcommand{\algorithmicif}{{\bfseries\sffamily if}}
\algrenewcommand{\algorithmicelse}{{\bfseries\sffamily else}}
\algrenewcommand{\algorithmicthen}{{\bfseries\sffamily then}}
\algrenewcommand{\algorithmicdo}{{\bfseries\sffamily do}}
\usepackage{multicol}
\usepackage{bussproofs}
\usepackage{tikz}

\newcommand{\dom}{\mathop{\mathrm{dom}}}
\newcommand{\True}{\mathbf{true}}
\newcommand{\False}{\mathbf{false}}

\newcommand{\Trnt}{\mathsf{T}}
\newcommand{\trnt}[1][]{{\circ^{#1}}}
\newcommand{\Stdy}{\mathsf{S}}
\newcommand{\stdy}[1][]{{\bullet^{#1}}}
\newcommand{\Final}{\mathsf{F}}
\newcommand{\final}{{\uparrow}}
\newcommand{\full}[1][]{{\color{grey}\circ^{#1}}}

\newcommand{\qinit}{\iota}
\newcommand{\Lab}{\Lambda}
\newcommand{\emptystr}{\epsilon}

\newcommand{\orelse}{\mathbin{?}}
\newcommand{\alap}{\mathop{!}}
\newcommand{\on}{\mathbin{{:}{:}}}
\newcommand{\tries}{\mathrel{\mathit{tries}}}
\newcommand{\cando}{\mathrel{\mathit{can}}}
\newcommand{\ncando}{\centernot{\cando}}
\newcommand{\ifnot}{{\hat{\;}}}
\newcommand{\term}{\varepsilon}
\newcommand{\close}[1]{\bar{#1}}
\newcommand{\closex}[1]{\overline{#1}}

\newcommand{\LTduce}{\mathbf{LT}}
\newcommand{\STduce}{\mathbf{ST}}
\newcommand{\any}{\_}
\newcommand{\Traces}{\mathit{traces}}

\newcommand{\ruleis}{\;::=\;}
\newcommand{\rulemid}{\:\mid\:}

% Inner and outer
\newcommand{\kInner}{innr}
\newcommand{\Inner}[1][\,]{\ensuremath{\mathit{\kInner}_{\!#1}}\xspace}
\newcommand{\pInner}{\mbox{\textit{\uline{\kInner}}}\xspace}
\newcommand{\kOuter}{outr}
\newcommand{\Outer}[1][\,]{\ensuremath{\mathit{\kOuter}_{\!#1}}\xspace}
\newcommand{\pOuter}{\mbox{\uline{$\mathit{\kOuter}$}}\xspace}

\newcommand{\Init}[1][\,]{\ensuremath{\iota}_{\!#1}\xspace}
\newcommand{\pInit}{\mbox{\uline{$\iota$}}\xspace}

% Open and closed
\newcommand{\Open}[1][\,]{\ensuremath{\mathit{open}}_{\!#1}\xspace}
\newcommand{\Closed}[1][]{\ensuremath{\mathit{clsd}_{#1}}\xspace}
\newcommand{\pClosed}{\mbox{\uline{\textit{clsd}}}\xspace}
\newcommand{\pOpen}{\mbox{\uline{\textit{open}}}\xspace}

% Absent and presend
\newcommand{\kAbsent}{abst}
\newcommand{\Absent}[1][]{\ensuremath{\mathit{\kAbsent}}_{#1}\xspace}
\newcommand{\pAbsent}{\mbox{\uline{\textit{\kAbsent}}}\xspace}
\newcommand{\kPresent}{prst}
\newcommand{\Present}[1][\,]{\ensuremath{\mathit{\kPresent}}_{\!#1}\xspace}
\newcommand{\pPresent}{\mbox{\uline{\textit{\kPresent}}}\xspace}

% Steady and transient
\newcommand{\kSteady}{stdy}
\newcommand{\Steady}[1][\mkern1mu]{\ensuremath{\mathit{\kSteady}}_{\mkern-1mu#1}\xspace}
\newcommand{\pSteady}{\mbox{\textit{\uline{\kSteady}}}\xspace}
\newcommand{\kTransient}{trnt}
\newcommand{\Transient}[1][\,]{\ensuremath{\mathit{\kTransient}}_{\!#1}\xspace}
\newcommand{\pTransient}{\mbox{\textit{\uline{\kTransient}}}\xspace}

% Fertile and barren
\newcommand{\kFertile}{frtl}
\newcommand{\pFertile}{\mbox{\textit{\uline{\kFertile}}}\xspace}
\newcommand{\kBarren}{brrn}
\newcommand{\pBarren}{\mbox{\textit{\uline{\kBarren}}}\xspace}

% Transience level
\newcommand{\TLevel}[1][]{\ensuremath{\tau}_{#1}\xspace}
\newcommand{\pTLevel}{\mbox{\uline{$\tau$}}\xspace}

% Absence level
\newcommand{\ALevel}[1][]{\ensuremath{\alpha}_{#1}\xspace}
\newcommand{\pALevel}{\mbox{\uline{$\alpha$}}\xspace}

% Outer level
\newcommand{\OLevel}[1][\,]{\ensuremath{o}_{\!#1}\xspace}
% Recipe mapping
\newcommand{\Recipe}[1][\,]{\ensuremath{\rho}_{\!#1}\xspace}

% Partiality of a transition
\newcommand{\Partial}[1][]{\ensuremath{\mathit{part}}_{\!#1}\xspace}
\newcommand{\Atomic}[1][]{\ensuremath{\mathit{atom}}_{\!#1}\xspace}

\newcommand{\rC}{\mathsf{C}}
\newcommand{\rF}{\mathsf{F}}
\newcommand{\rR}{\mathsf{R}}

\newcommand{\cI}{\mathcal{I}}
\newcommand{\cP}{\mathcal{P}}
\newcommand{\cR}{\mathcal{R}}
\newcommand{\cS}{\mathcal{S}}

\newcommand{\natN}{\mathbb{N}}
\newcommand{\boolB}{\mathbb{B}}

\newcommand{\setof}[1]{\{{#1}\}}
\newcommand{\gensetof}[2]{\setof{{#1}\mid{#2}}}
\newcommand{\tupof}[1]{\langle{#1}\rangle}
\newcommand{\powersetof}[1]{\cP({#1})}
\newcommand{\iffdef}{:\Leftrightarrow}
% Partial function
\newcommand{\pto}{\hookrightarrow}
% Such that
\newcommand{\st}{.\,}

\newenvironment{inumerate}{%
  \begin{enumerate*}[label=\emph{(\roman*)}]
}{%
  \end{enumerate*}%
}
% Special arrows

% Typeset the label of an extensible arrow by lowering the text
\newcommand{\lowerlabel}[1]{\smash{\mathchoice
		{\raisebox{-1.5pt}{$\scriptstyle#1$}}
		{\raisebox{-1.5pt}{$\scriptstyle#1$}}
		{\raisebox{-1pt}{$\scriptstyle#1$}}
		{\raisebox{-1pt}{$\scriptscriptstyle#1$}}
}}
% Typeset the label of an extensible arrow by lowering the text further
\newcommand{\lowerlabelx}[1]{\smash{\mathchoice
		{\raisebox{-3pt}{$\scriptstyle#1$}}
		{\raisebox{-3pt}{$\scriptstyle#1$}}
		{\raisebox{-2pt}{$\scriptstyle#1$}}
		{\raisebox{-2pt}{$\scriptscriptstyle#1$}}
}}
% Typeset the lower label of an extensible arrow by raising the text
\newcommand{\raiselabel}[1]{\smash{\mathchoice
		{\raisebox{1.5pt}{$\scriptstyle#1$}}
		{\raisebox{1.5pt}{$\scriptstyle#1$}}
		{\raisebox{1pt}{$\scriptstyle#1$}}
		{\raisebox{1pt}{$\scriptscriptstyle#1$}}
}}
% Typeset the lower label of an extensible arrow by raising the text further
\newcommand{\raiselabelx}[1]{\smash{\mathchoice
		{\raisebox{3pt}{$\scriptstyle#1$}}
		{\raisebox{3pt}{$\scriptstyle#1$}}
		{\raisebox{2pt}{$\scriptstyle#1$}}
		{\raisebox{2pt}{$\scriptscriptstyle#1$}}
}}
% Typeset the lower label of an extensible arrow by raising the text even further
\newcommand{\raiselabelxx}[1]{\smash{\mathchoice
		{\raisebox{4.5pt}{$\scriptstyle#1$}}
		{\raisebox{4.5pt}{$\scriptstyle#1$}}
		{\raisebox{3pt}{$\scriptstyle#1$}}
		{\raisebox{3pt}{$\scriptscriptstyle#1$}}
}}

% Prepend a negation to an extensible arrow
\newcommand{\xarrownot}{\mathrel{\arrownot-}\mkern-7mu}

% single-arrow transduction
%\newcommand{\tduce}[3][\,]{\mathrel{
%  \smash{\xrightarrow[\raiselabelxx{#3}]{\lowerlabel{#2}}_{\!#1}}
%  \vphantom{\xrightarrow{\lowerlabel{#2}}_{\!#1}}
%}}
\newcommand{\tduce}[3][\,]{\trans[#1]{{#2}{\on}{#3}}}

% double-arrow transduction
%\newcommand{\Tduce}[3][\,]{\mathrel{
%  \smash{\xRightarrow[\raiselabelxx{#3}]{\lowerlabel{#2}}_{\!#1}}
%  \vphantom{\xrightarrow{\lowerlabel{#2}}}
%}}
\newcommand{\Tduce}[2]{\Trans{{#1}{\on}{#2}}}

% single-arrow transition
\newcommand{\trans}[2][\,]{\mathchoice
  {\inlinetrans[#1]{#2}}
  {\inlinetrans[#1]{#2}}
  {\inlinetrans[#1]{#2}}
  {\inlinetrans[#1]{#2}}
}
\newcommand{\inlinetrans}[2][\,]{\mathrel{
  \smash{\xrightarrow{\lowerlabel{#2}}_{\!#1}}
  \vphantom{\xrightarrow{\lowerlabel{#2}}}
}}
\newcommand{\displaytrans}[2][\,]{\mathrel{
  \smash{\xrightarrow{\lowerlabel{#2}}_{\!#1}}
  \vphantom{\xrightarrow{X}}
}}
% negative single-arrow transition
\newcommand{\ntrans}[2][\,]{\mathrel{\xarrownot\trans{#2}}_{\!#1}}

% doublie-arrow transition
\newcommand{\Trans}[2][\,]{\mathchoice
  {\displayTrans[#1]{#2}}
  {\displayTrans[#1]{#2}}
  {\inlineTrans[#1]{#2}}
  {\inlineTrans[#1]{#2}}
}
\newcommand{\inlineTrans}[2][\,]{\mathrel{
  \smash{\xRightarrow{\smash{\lowerlabel{#2}}}_{\!#1}}
  \vphantom{\xrightarrow{\smash{\lowerlabel{#2}}}}
}}
\newcommand{\displayTrans}[2][\,]{\mathrel{
  \smash{\xRightarrow{#2}_{\!#1}}
  \vphantom{\xrightarrow{#2}}
}}
% negative single-arrow transition
\newcommand{\nTrans}[2][\,]{\mathrel{\xarrownot\Trans{#2}}_{\!#1}}

%%%% Recapture the mapstochar, which is set to undefined by MnSymbol
\usepackage{trimclip}

\makeatletter
\providecommand{\mapstochar}{\mathrel{\mathpalette\mapstochar@\relax}}
\newcommand{\mapstochar@}[2]{%
	\makebox[0pt][l]{%
		\clipbox{0 0 {0.8\width} 0}{$\m@th#1\mapsto$}%
	}%
}
\makeatother
